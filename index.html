<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Draft Internal - Analisis Biaya Pallet</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .input-group label { font-size: 0.875rem; font-weight: 600; color: #374151; }
        .currency-input { position: relative; }
        .currency-input span { position: absolute; left: 12px; top: 50%; transform: translateY(-50%); color: #6B7280; font-size: 0.9rem; }
        .currency-input input { padding-left: 38px; }
        .active-mat { background-color: #2563EB; color: white; border-color: #2563EB; }
        .inactive-mat { background-color: white; color: #4B5563; border-color: #D1D5DB; }
    </style>
</head>
<body class="bg-slate-100 text-slate-800 min-h-screen p-4 md:p-8 relative overflow-x-hidden">

    <!-- Watermark Draft Internal -->
    <div class="fixed inset-0 pointer-events-none flex items-center justify-center z-0">
        <span class="text-[8rem] md:text-[12rem] font-bold text-slate-300 opacity-20 transform -rotate-45 whitespace-nowrap select-none">DRAFT INTERNAL</span>
    </div>

    <div class="max-w-6xl mx-auto relative z-10">
        <!-- Header -->
        <header class="mb-8 text-center md:text-left flex flex-col md:flex-row justify-between items-center bg-white p-6 rounded-2xl shadow-sm border border-slate-200 border-l-4 border-l-yellow-500">
            <div>
                <div class="flex items-center justify-center md:justify-start gap-3 mb-1">
                    <h1 class="text-2xl font-bold text-slate-900"><i class="fas fa-pallet text-blue-600 mr-2"></i>Pallet Project Bahan Kayu</h1>
                    <span class="bg-yellow-100 text-yellow-800 text-[10px] font-bold px-2 py-0.5 rounded border border-yellow-200 uppercase tracking-wide">Draft Internal</span>
                </div>
                <div class="flex items-center justify-center md:justify-start gap-2 mt-1">
                    <span class="bg-indigo-100 text-indigo-700 text-xs font-bold px-2 py-1 rounded border border-indigo-200">
                        <i class="fas fa-weight-hanging mr-1"></i> Kapasitas: Min. 2 Ton
                    </span>
                    <span class="text-slate-500 text-sm">Beli vs Buat Sendiri</span>
                </div>
            </div>
            <div class="mt-4 md:mt-0 text-right">
                <div class="text-xs text-slate-500 font-semibold uppercase tracking-wider">Benchmark Pasar</div>
                <div class="text-3xl font-bold text-blue-600">Rp 35.000<span class="text-sm text-slate-400 font-normal">/pcs</span></div>
            </div>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">
            
            <!-- LEFT COLUMN: INPUTS -->
            <div class="lg:col-span-4 space-y-6">
                
                <!-- NEW: Volume Production Input -->
                <div class="bg-indigo-50 border border-indigo-100 p-6 rounded-2xl shadow-sm">
                    <h2 class="text-lg font-bold mb-4 flex items-center text-indigo-900">
                        <i class="fas fa-cubes mr-2 text-indigo-600"></i> Skala Produksi
                    </h2>
                    <div>
                        <label class="block text-sm font-medium text-indigo-800 mb-1">Volume Kebutuhan Per Bulan (Pcs)</label>
                        <input type="number" id="volumeMonth" value="4000" class="w-full bg-white border border-indigo-200 text-slate-900 font-bold text-lg rounded-lg focus:ring-indigo-500 focus:border-indigo-500 block p-2.5 shadow-sm" oninput="calculate()">
                    </div>
                </div>

                <!-- Component Costs -->
                <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200">
                    <h2 class="text-lg font-bold mb-4 flex items-center text-slate-700">
                        <i class="fas fa-tools mr-2 text-orange-500"></i> Spesifikasi & Material
                    </h2>
                    
                    <!-- Material Selection Toggle -->
                    <div class="mb-5">
                        <label class="block text-sm font-medium text-slate-700 mb-2">Pilih Material Alas (Top Deck)</label>
                        <div class="flex space-x-2">
                            <button onclick="setMaterial('kayu')" id="btnKayu" class="flex-1 py-2 px-3 rounded-lg border text-sm font-bold active-mat transition-all">
                                <i class="fas fa-tree mr-1"></i> Full Kayu
                            </button>
                            <button onclick="setMaterial('bambu')" id="btnBambu" class="flex-1 py-2 px-3 rounded-lg border text-sm font-bold inactive-mat transition-all hover:bg-green-50">
                                <i class="fas fa-leaf mr-1 text-green-600"></i> Bambu Betung
                            </button>
                        </div>
                        <p id="materialDesc" class="text-xs text-slate-500 mt-2 italic">Menggunakan papan kayu sengon/albasia standar.</p>
                    </div>

                    <!-- Fixed Cost: Jasa -->
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-slate-700 mb-1">Biaya Jasa (Tenaga Kerja)</label>
                        <div class="currency-input">
                            <span>Rp</span>
                            <input type="number" id="costJasa" value="3000" class="w-full bg-slate-50 border border-slate-300 text-slate-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block p-2.5" placeholder="0" oninput="calculate()">
                        </div>
                    </div>

                    <div class="border-t border-slate-200 my-4"></div>

                    <h3 class="text-sm font-bold text-slate-800 mb-3 uppercase tracking-wide">Harga Bahan Baku (Satuan)</h3>

                    <!-- Material: Papan/Bambu -->
                    <div class="mb-3">
                        <label class="flex justify-between text-sm font-medium text-slate-700 mb-1">
                            <span id="labelPapan">Papan Kayu (Per Lembar)</span>
                            <span class="bg-blue-100 text-blue-800 text-xs font-semibold px-2 py-0.5 rounded">Butuh: 8 pcs</span>
                        </label>
                        <div class="currency-input">
                            <span>Rp</span>
                            <input type="number" id="pricePapan" value="2500" class="w-full border border-slate-300 text-slate-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block p-2.5 shadow-sm bg-white" placeholder="0" oninput="calculate()">
                        </div>
                    </div>

                    <!-- Material: Balok -->
                    <div class="mb-3">
                        <label class="flex justify-between text-sm font-medium text-slate-700 mb-1">
                            <span>Balok Penopang (Per Batang)</span>
                            <span class="bg-blue-100 text-blue-800 text-xs font-semibold px-2 py-0.5 rounded">Butuh: 4 pcs</span>
                        </label>
                        <div class="currency-input">
                            <span>Rp</span>
                            <input type="number" id="priceBalok" value="3500" class="w-full border border-slate-300 text-slate-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block p-2.5 shadow-sm" placeholder="0" oninput="calculate()">
                        </div>
                        <p class="text-xs text-slate-400 mt-1">Biasanya tetap menggunakan kayu keras agar paku kuat.</p>
                    </div>

                    <!-- Material: Paku -->
                    <div class="mb-3">
                        <label class="flex justify-between text-sm font-medium text-slate-700 mb-1">
                            <span>Paku (Per Biji/Pcs)</span>
                            <span class="bg-blue-100 text-blue-800 text-xs font-semibold px-2 py-0.5 rounded">Butuh: 40 pcs</span>
                        </label>
                        <div class="currency-input">
                            <span>Rp</span>
                            <input type="number" id="pricePaku" value="100" class="w-full border border-slate-300 text-slate-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block p-2.5 shadow-sm" placeholder="0" oninput="calculate()">
                        </div>
                    </div>

                </div>
            </div>

            <!-- RIGHT COLUMN: ANALYSIS -->
            <div class="lg:col-span-8 space-y-6">

                <!-- Specs Alert (Re-added) -->
                <div class="bg-blue-50 border border-blue-200 p-4 rounded-xl flex items-start gap-3">
                    <i class="fas fa-info-circle text-blue-600 mt-1"></i>
                    <div>
                        <h4 class="text-sm font-bold text-blue-800">Spesifikasi Beban: Min 2 Ton</h4>
                        <p class="text-xs text-blue-700 mt-1">
                            Untuk mencapai kapasitas statis 2 ton, perhatikan hal berikut:
                            <ul class="list-disc ml-4 mt-1">
                                <li><strong>Opsi Kayu:</strong> Pastikan balok penopang menggunakan kayu keras (bukan albasia muda) agar paku tidak mudah lepas.</li>
                                <li><strong>Opsi Bambu:</strong> Gunakan bambu bagian pangkal/tengah dengan ketebalan bilah minimal 1.5 cm.</li>
                            </ul>
                        </p>
                    </div>
                </div>
                
                <!-- Main Result Card -->
                <div id="resultCard" class="bg-white p-6 rounded-2xl shadow-lg border-t-4 border-gray-300 transition-all">
                    <div class="flex justify-between items-start mb-4">
                        <h2 class="text-lg font-bold text-slate-800">Analisis Per Unit Pallet</h2>
                        <span id="badgeStatus" class="px-3 py-1 rounded-full text-sm font-bold bg-gray-100 text-gray-500">Belum ada data</span>
                    </div>

                    <div class="grid grid-cols-2 gap-4 mb-6">
                        <div class="p-4 bg-slate-50 rounded-xl border border-slate-100 relative overflow-hidden">
                            <div class="absolute right-0 top-0 p-2 opacity-10">
                                <i id="iconResult" class="fas fa-tree text-6xl"></i>
                            </div>
                            <p class="text-xs text-slate-500 uppercase font-semibold">Biaya Produksi Sendiri</p>
                            <p class="text-3xl font-bold text-slate-800 mt-1" id="displayTotalMake">Rp 0</p>
                        </div>
                        <div class="p-4 bg-blue-50 rounded-xl border border-blue-100">
                            <p class="text-xs text-blue-500 uppercase font-semibold">Harga Saat Ini</p>
                            <p class="text-3xl font-bold text-blue-700 mt-1">Rp 35.000</p>
                        </div>
                    </div>

                    <!-- Progress Bar -->
                    <div class="relative pt-1 mb-2">
                        <div class="flex mb-2 items-center justify-between">
                            <div class="text-xs font-semibold inline-block py-1 px-2 uppercase rounded-full text-slate-600 bg-slate-200">
                                Penggunaan Budget
                            </div>
                            <div class="text-right">
                                <span class="text-xs font-semibold inline-block text-slate-600" id="percentageUsage">0%</span>
                            </div>
                        </div>
                        <div class="overflow-hidden h-4 mb-4 text-xs flex rounded bg-slate-200">
                            <div id="progressBar" style="width:0%" class="shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center bg-blue-500 transition-all duration-500"></div>
                        </div>
                    </div>

                    <div id="recommendationText" class="text-sm p-3 rounded-lg bg-gray-50 border border-gray-200 text-gray-600">
                        ...
                    </div>
                </div>

                <!-- NEW: Recommendation Card (Strategi Efisiensi) -->
                <div id="efficiencyCard" class="hidden bg-amber-50 border border-amber-200 p-6 rounded-2xl shadow-sm transition-all">
                    <h3 class="font-bold text-amber-800 mb-2 flex items-center">
                        <i class="fas fa-lightbulb mr-2"></i>Target Harga Beli Bahan
                    </h3>
                    <p class="text-sm text-amber-700 mb-4">
                        Agar total biaya masuk budget Rp 35.000, Anda harus menawar di angka ini:
                    </p>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
                        <div class="bg-white p-3 rounded-lg border border-amber-100">
                            <span class="block text-xs font-medium text-slate-500 mb-1" id="recLabelPapan">Papan /lembar</span>
                            <div class="flex justify-between items-end">
                                <span class="text-xs text-red-400 line-through" id="recOldPapan">-</span>
                                <span class="font-bold text-green-600 text-lg" id="recNewPapan">-</span>
                            </div>
                        </div>
                        <div class="bg-white p-3 rounded-lg border border-amber-100">
                            <span class="block text-xs font-medium text-slate-500 mb-1">Balok /batang</span>
                            <div class="flex justify-between items-end">
                                <span class="text-xs text-red-400 line-through" id="recOldBalok">-</span>
                                <span class="font-bold text-green-600 text-lg" id="recNewBalok">-</span>
                            </div>
                        </div>
                        <div class="bg-white p-3 rounded-lg border border-amber-100">
                            <span class="block text-xs font-medium text-slate-500 mb-1">Paku /biji</span>
                            <div class="flex justify-between items-end">
                                <span class="text-xs text-red-400 line-through" id="recOldPaku">-</span>
                                <span class="font-bold text-green-600 text-lg" id="recNewPaku">-</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Monthly Simulation -->
                <div class="bg-slate-800 text-white p-6 rounded-2xl shadow-xl border border-slate-700">
                    <div class="flex justify-between items-center mb-6 border-b border-slate-700 pb-4">
                        <h3 class="font-bold text-xl"><i class="fas fa-chart-pie mr-2 text-indigo-400"></i>Simulasi Bulanan (Volume: <span id="dispVol" class="text-indigo-400">4.000</span> pcs)</h3>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 text-center">
                         <div class="bg-slate-700/50 p-4 rounded-xl border border-slate-600">
                            <p class="text-slate-400 text-xs uppercase font-bold tracking-wider mb-2">Total Biaya Jika Beli</p>
                            <p class="font-bold text-xl md:text-2xl text-white" id="monthlyBuyCost">Rp 140.000.000</p>
                         </div>
                         <div class="bg-slate-700/50 p-4 rounded-xl border border-slate-600 relative">
                             <div class="hidden md:block absolute -left-4 top-1/2 transform -translate-y-1/2 z-10 bg-slate-600 rounded-full p-1 border border-slate-500">
                                 <i class="fas fa-arrow-right text-xs text-slate-300"></i>
                             </div>
                            <p class="text-slate-400 text-xs uppercase font-bold tracking-wider mb-2">Total Biaya Produksi</p>
                            <p class="font-bold text-xl md:text-2xl text-white" id="monthlyMakeCost">Rp 0</p>
                         </div>
                         <div class="bg-gradient-to-br from-indigo-600 to-blue-700 p-4 rounded-xl border border-indigo-500 shadow-lg transform scale-105">
                            <p class="text-indigo-100 text-xs uppercase font-bold tracking-wider mb-2">Selisih (Profit/Loss)</p>
                            <p class="font-bold text-xl md:text-2xl text-white" id="monthlySavings">Rp 0</p>
                         </div>
                    </div>
                    
                    <div class="mt-6 pt-4 border-t border-slate-700 flex justify-between items-center text-sm">
                        <span class="text-slate-400">Proyeksi 1 Tahun:</span>
                        <span class="font-bold text-lg text-emerald-400" id="yearlyProjection">Rp 0</span>
                    </div>
                </div>

                <!-- Detailed Breakdown Table -->
                <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200">
                    <h3 class="font-bold text-slate-700 mb-4">Rincian Komponen Biaya</h3>
                    <div class="overflow-x-auto">
                        <table class="w-full text-sm text-left text-slate-600">
                            <thead class="text-xs text-slate-700 uppercase bg-slate-50 border-b">
                                <tr>
                                    <th class="px-4 py-3">Komponen</th>
                                    <th class="px-4 py-3 text-right">Vol</th>
                                    <th class="px-4 py-3 text-right">Harga Satuan</th>
                                    <th class="px-4 py-3 text-right">Subtotal</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-slate-100">
                                <tr>
                                    <td class="px-4 py-3 font-medium flex items-center">
                                        <i id="iconTablePapan" class="fas fa-tree mr-2 text-slate-400"></i>
                                        <span id="nameTablePapan">Papan Kayu</span>
                                    </td>
                                    <td class="px-4 py-3 text-right">8</td>
                                    <td class="px-4 py-3 text-right" id="rowPricePapan">-</td>
                                    <td class="px-4 py-3 text-right font-bold text-slate-800" id="rowTotalPapan">Rp 0</td>
                                </tr>
                                <tr>
                                    <td class="px-4 py-3 font-medium">Balok</td>
                                    <td class="px-4 py-3 text-right">4</td>
                                    <td class="px-4 py-3 text-right" id="rowPriceBalok">-</td>
                                    <td class="px-4 py-3 text-right font-bold text-slate-800" id="rowTotalBalok">Rp 0</td>
                                </tr>
                                <tr>
                                    <td class="px-4 py-3 font-medium">Paku</td>
                                    <td class="px-4 py-3 text-right">40</td>
                                    <td class="px-4 py-3 text-right" id="rowPricePaku">-</td>
                                    <td class="px-4 py-3 text-right font-bold text-slate-800" id="rowTotalPaku">Rp 0</td>
                                </tr>
                                <tr class="bg-slate-50">
                                    <td class="px-4 py-3 font-medium text-orange-600">Biaya Jasa</td>
                                    <td class="px-4 py-3 text-right" colspan="2">SDM</td>
                                    <td class="px-4 py-3 text-right font-bold text-orange-600" id="rowTotalOps">Rp 3.000</td>
                                </tr>
                            </tbody>
                            <tfoot class="border-t-2 border-slate-200">
                                <tr>
                                    <td class="px-4 py-3 font-bold text-lg">TOTAL</td>
                                    <td class="px-4 py-3" colspan="2"></td>
                                    <td class="px-4 py-3 text-right font-bold text-lg text-blue-700" id="tableTotalMake">Rp 0</td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                </div>

            </div>
        </div>

        <!-- NEW FOOTER SECTION -->
        <footer class="mt-12 mb-4 border-t-2 border-slate-200 pt-8 text-center print:border-t-0">
            <div class="flex flex-col items-center justify-center">
                <p class="text-slate-700 font-bold text-sm tracking-wide">
                    &copy; <span id="copyrightYear"></span> Dept SCM PT Mitra Kiara Indonesia
                </p>
                <p class="text-slate-400 text-xs mt-1 uppercase tracking-wider">Dokumen Internal - Rahasia Perusahaan</p>
            </div>
        </footer>

    </div>

    <script>
        // Constants
        const BUY_PRICE = 35000;
        const QTY_PAPAN = 8;
        const QTY_BALOK = 4;
        const QTY_PAKU = 40;

        let currentMaterial = 'kayu'; // 'kayu' or 'bambu'

        // Set Copyright Year dynamically
        document.getElementById('copyrightYear').innerText = new Date().getFullYear();

        function formatRupiah(num) {
            return new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR', minimumFractionDigits: 0 }).format(num);
        }

        function getVal(id) {
            return parseFloat(document.getElementById(id).value) || 0;
        }

        function setMaterial(type) {
            currentMaterial = type;
            const btnKayu = document.getElementById('btnKayu');
            const btnBambu = document.getElementById('btnBambu');
            const labelPapan = document.getElementById('labelPapan');
            const inputPapan = document.getElementById('pricePapan');
            const desc = document.getElementById('materialDesc');
            const iconResult = document.getElementById('iconResult');

            if (type === 'kayu') {
                btnKayu.className = "flex-1 py-2 px-3 rounded-lg border text-sm font-bold active-mat transition-all";
                btnBambu.className = "flex-1 py-2 px-3 rounded-lg border text-sm font-bold inactive-mat transition-all hover:bg-green-50";
                
                labelPapan.innerText = "Papan Kayu (Per Lembar)";
                desc.innerText = "Menggunakan papan kayu sengon/albasia standar.";
                inputPapan.value = "2500"; // Default Price Kayu
                iconResult.className = "fas fa-tree text-6xl";
            } else {
                btnKayu.className = "flex-1 py-2 px-3 rounded-lg border text-sm font-bold inactive-mat transition-all hover:bg-blue-50";
                btnBambu.className = "flex-1 py-2 px-3 rounded-lg border text-sm font-bold bg-green-600 text-white border-green-600 transition-all";
                
                labelPapan.innerText = "Bilah Bambu Betung (Per Batang)";
                desc.innerHTML = "<span class='text-green-600 font-bold'>Rekomendasi Hemat!</span> Bambu Betung sangat kuat untuk beban >2 Ton. Harga jauh lebih murah.";
                inputPapan.value = "1200"; // Default Price Bambu (Est)
                iconResult.className = "fas fa-leaf text-6xl text-green-200";
            }
            calculate();
        }

        function calculate() {
            // Inputs
            const jasa = getVal('costJasa');
            const pPapan = getVal('pricePapan');
            const pBalok = getVal('priceBalok');
            const pPaku = getVal('pricePaku');
            const volMonth = getVal('volumeMonth');

            // UI Label Updates based on material
            if(currentMaterial === 'bambu') {
                document.getElementById('nameTablePapan').innerText = "Bilah Bambu Betung";
                document.getElementById('iconTablePapan').className = "fas fa-leaf mr-2 text-green-500";
                document.getElementById('recLabelPapan').innerText = "Bambu /bilah";
            } else {
                document.getElementById('nameTablePapan').innerText = "Papan Kayu";
                document.getElementById('iconTablePapan').className = "fas fa-tree mr-2 text-slate-400";
                document.getElementById('recLabelPapan').innerText = "Papan /lembar";
            }

            // Unit Calculations
            const totalPapan = pPapan * QTY_PAPAN;
            const totalBalok = pBalok * QTY_BALOK;
            const totalPaku = pPaku * QTY_PAKU;
            const totalOps = jasa;
            
            const totalMaterial = totalPapan + totalBalok + totalPaku;
            const totalMakeCost = totalMaterial + totalOps;

            // Monthly Calculations
            const monthlyBuyTotal = BUY_PRICE * volMonth;
            const monthlyMakeTotal = totalMakeCost * volMonth;
            const monthlyDiff = monthlyBuyTotal - monthlyMakeTotal;
            const yearlyDiff = monthlyDiff * 12;

            // DOM Updates - Table
            document.getElementById('rowPricePapan').innerText = formatRupiah(pPapan);
            document.getElementById('rowTotalPapan').innerText = formatRupiah(totalPapan);
            
            document.getElementById('rowPriceBalok').innerText = formatRupiah(pBalok);
            document.getElementById('rowTotalBalok').innerText = formatRupiah(totalBalok);

            document.getElementById('rowPricePaku').innerText = formatRupiah(pPaku);
            document.getElementById('rowTotalPaku').innerText = formatRupiah(totalPaku);

            document.getElementById('rowTotalOps').innerText = formatRupiah(totalOps);
            document.getElementById('tableTotalMake').innerText = formatRupiah(totalMakeCost);

            // DOM Updates - Main Card
            document.getElementById('displayTotalMake').innerText = formatRupiah(totalMakeCost);

            // DOM Updates - Monthly Simulation
            document.getElementById('dispVol').innerText = new Intl.NumberFormat('id-ID').format(volMonth);
            document.getElementById('monthlyBuyCost').innerText = formatRupiah(monthlyBuyTotal);
            document.getElementById('monthlyMakeCost').innerText = formatRupiah(monthlyMakeTotal);
            
            const monthlySavingsEl = document.getElementById('monthlySavings');
            const yearlyProjectionEl = document.getElementById('yearlyProjection');

            if (monthlyDiff > 0) {
                // Untung / Hemat
                monthlySavingsEl.innerText = "+" + formatRupiah(monthlyDiff);
                monthlySavingsEl.className = "font-bold text-xl md:text-2xl text-emerald-300"; // Greenish text
                yearlyProjectionEl.innerText = "+" + formatRupiah(yearlyDiff) + " / tahun";
                yearlyProjectionEl.className = "font-bold text-lg text-emerald-400";
            } else {
                // Rugi
                monthlySavingsEl.innerText = formatRupiah(monthlyDiff); // Negative format handled by Intl usually or manually adds -
                monthlySavingsEl.className = "font-bold text-xl md:text-2xl text-red-300"; // Reddish text
                yearlyProjectionEl.innerText = formatRupiah(yearlyDiff) + " / tahun";
                yearlyProjectionEl.className = "font-bold text-lg text-red-400";
            }

            // Progress Bar & Status Logic
            const percentage = Math.min((totalMakeCost / BUY_PRICE) * 100, 100);
            const progressBar = document.getElementById('progressBar');
            const badge = document.getElementById('badgeStatus');
            const resultCard = document.getElementById('resultCard');
            const recText = document.getElementById('recommendationText');
            const effCard = document.getElementById('efficiencyCard');
            
            progressBar.style.width = percentage + "%";
            document.getElementById('percentageUsage').innerText = Math.round((totalMakeCost / BUY_PRICE) * 100) + "%";

            // Calculation for Max Budget
            const maxMaterialBudget = BUY_PRICE - totalOps;

            // Status Logic
            if (totalMakeCost === 0 && pPapan === 0) {
                 // Initial State
                badge.className = "px-3 py-1 rounded-full text-sm font-bold bg-gray-100 text-gray-500";
                badge.innerText = "Menunggu Input";
                progressBar.className = "shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center bg-blue-500 transition-all duration-500";
                resultCard.className = "bg-white p-6 rounded-2xl shadow-lg border-t-4 border-gray-300 transition-all";
                effCard.classList.add('hidden');
            } 
            else if (totalMakeCost <= BUY_PRICE) {
                // Efficient
                const savings = BUY_PRICE - totalMakeCost;
                badge.className = "px-3 py-1 rounded-full text-sm font-bold bg-green-100 text-green-700";
                badge.innerHTML = "<i class='fas fa-check-circle'></i> EFISIEN";
                progressBar.className = "shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center bg-green-500 transition-all duration-500";
                resultCard.className = "bg-white p-6 rounded-2xl shadow-lg border-t-4 border-green-500 transition-all";
                recText.className = "text-sm p-3 rounded-lg bg-green-50 border border-green-200 text-green-800";
                
                let materialName = currentMaterial === 'bambu' ? "Bambu Betung" : "Papan Kayu";
                recText.innerHTML = `<strong>Rekomendasi: BUAT SENDIRI (${materialName}).</strong><br>Anda menghemat <strong>${formatRupiah(savings)}</strong> per pallet.`;
                effCard.classList.add('hidden');
            } 
            else {
                // Inefficient
                const loss = totalMakeCost - BUY_PRICE;
                badge.className = "px-3 py-1 rounded-full text-sm font-bold bg-red-100 text-red-700";
                badge.innerHTML = "<i class='fas fa-times-circle'></i> MAHAL";
                progressBar.className = "shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center bg-red-500 transition-all duration-500";
                resultCard.className = "bg-white p-6 rounded-2xl shadow-lg border-t-4 border-red-500 transition-all";
                recText.className = "text-sm p-3 rounded-lg bg-red-50 border border-red-200 text-red-800";
                recText.innerHTML = `<strong>Rekomendasi: LEBIH BAIK BELI.</strong><br>Biaya produksi lebih mahal <strong>${formatRupiah(loss)}</strong> dibanding harga pasar.`;
                
                // SHOW RECOMMENDATION LOGIC
                effCard.classList.remove('hidden');
                
                const reductionRatio = maxMaterialBudget / totalMaterial;

                const targetPapan = Math.floor(pPapan * reductionRatio);
                const targetBalok = Math.floor(pBalok * reductionRatio);
                const targetPaku = Math.floor(pPaku * reductionRatio);

                document.getElementById('recOldPapan').innerText = formatRupiah(pPapan);
                document.getElementById('recNewPapan').innerText = formatRupiah(targetPapan);

                document.getElementById('recOldBalok').innerText = formatRupiah(pBalok);
                document.getElementById('recNewBalok').innerText = formatRupiah(targetBalok);

                document.getElementById('recOldPaku').innerText = formatRupiah(pPaku);
                document.getElementById('recNewPaku').innerText = formatRupiah(targetPaku);
            }
        }

        function resetValues() {
            setMaterial('kayu');
            document.getElementById('pricePapan').value = '2500';
            document.getElementById('priceBalok').value = '3500';
            document.getElementById('pricePaku').value = '100';
            document.getElementById('costJasa').value = '3000';
            document.getElementById('volumeMonth').value = '4000';
            calculate();
        }

        // Init
        calculate();
    </script>
</body>
</html>
